<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>代购</title>
		<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no"/>
		<link rel="stylesheet" href="lib/all.css" />
		<link rel="stylesheet" href="lib/css.css" />
		<link rel="stylesheet" href="lib/zepto.mdatetimer.css" />
		<style>
			body{
				background: #f3f5fe;
				font-size: 0.24rem;
			}
				.icons{
		background: url(./images/date.png) no-repeat;
		background-size:100% 100%; 
	}

	.jeinpbox{
		float: left;
		width: 3rem;
		margin-right: 0px;
		display: inline-block;
		vertical-align: middle;
		position: relative;
	}
	.jeinput{
		display: block;
		width: 100%;
		padding-left: .1rem; 
		height: .5rem;
		line-height: .36rem;
		border: 1px solid #e6e6e6;
		background-color: #fff;
		border-radius: 3px;
	}
	.jebtns{
		width: .5rem;
		margin-left: 5px; 
		margin-left: 3px;
		height: .6rem;
		line-height: 1;
		border: 1px solid #e6e6e6;
		background-color: #fff;
		border-radius: 3px;
		background-position:right center;
		float: left;
		cursor: pointer;
	}
			.supplier-address-in{
				width: 100% !important;
				margin-top: 3px !important;
				padding-left: 0.3rem !important;
				padding-right: 0.3rem !important;
				background: #FFFFFF;
				word-wrap: break-word;
				display:none;
			}
			.goodsWarehouse-address{
				 height:100% !important;
				 width: 100%;
				 background: #FFFFFF;
			}	
			.goodsWarehouse-address-in{
				width: 100% !important;
				margin-top: 3px !important;
				padding-left: 0.3rem !important;
				padding-right: 0.3rem !important;
				background: #FFFFFF;
				word-wrap: break-word !important;
				line-height: 100% ;
				height: 45px !important;
				display:none;
			}	
			header{
				width: 100%;
				height: 0.68rem;
				line-height: 0.68rem;
				padding-left: 0.36rem;
				font-size: 0.2rem;
			}
			#fullbg { 
background-color:gray; 
left:0; 
opacity:0.5; 
position:absolute; 
top:0; 
z-index:3; 
filter:alpha(opacity=50); 
-moz-opacity:0.5; 
-khtml-opacity:0.5; 
} 
#dialog { 
background-color:#fff; 
border:5px solid rgba(0,0,0, 0.4); 
height:400px; 
left:50%; 
margin:-200px 0 0 -200px; 
padding:1px; 
position:fixed !important; /* 浮动对话框 */ 
position:absolute; 
top:50%; 
width:400px; 
z-index:5; 
border-radius:5px; 
display:none; 
} 
#dialog p { 
margin:0 0 12px; 
height:24px; 
line-height:24px; 
background:#CCCCCC; 
} 
#dialog p.close { 
text-align:right; 
padding-right:10px; 
} 
#dialog p.close a { 
color:#fff; 
text-decoration:none; 
} 
			.supplier{
				margin-top: 0.2rem;
			}
			.supplier-addr-in select{
				width: 32%;
				height: 0.68rem;
				outline: none;
				border: none;
				background: #F3F5FE;
				border-radius: 0.08rem;
				font-size: 0.2rem;
				color: #CDCCCD;
			}	
			.goods{
				margin-bottom: 2.2rem;
			}
			.deal{
				text-align: center;
				height: 1.32rem;
				line-height: 1.32rem;
				margin-top: 0.7rem;
			}
			.deal>span:first-of-type{
				display: inline-block;
				width: 0.44rem;
				height: 0.44rem;
				background-size: 0.44rem 0.44rem;
				margin-right: 0.25rem;
			}
			.dealno{
				background: url(images/3.png) no-repeat center center;
				
			}
			.dealyes{
				background: url(images/1.png) no-repeat center center;
			}
			.deal>span{
				vertical-align: middle;
				font-size: 0.18rem;
			}
			.deal>a{
				vertical-align: middle;
				font-size: 0.18rem;
				color: #03dcc5;
			}						
		</style>

		<script src="lib/common.js"></script>
		<script type="text/javascript" src="lib/selfFit.js" ></script>
		<script type="text/javascript" src="lib/jquery-2.2.4.min.js" ></script>
		<script type="text/javascript" src="lib/distpicker.js" ></script>
		<script type="text/javascript" src="lib/arg-1.3.min.js"></script>
		<script type="text/javascript" src="lib/jquery.jedate.min.js"></script>
        <link rel="stylesheet" type="text/css" href="lib/jedate.css">
	</head>
	<body>
   <!--成功窗口-->
        <div id="result-success"> 
			<div class="result-bg"></div>
			<div class="result-show">
			     <div>
			     	<img src="images/4.png" id="result-pic" />
			     </div>
			     <div>
			     	<!--<p id="result-fail">失败原因——申请提交失败！</p>-->
			     	<p id="result-in">申请已提交！</p>
			     </div>
			</div>
		</div>

		 <!--失败窗口-->
        <div id="result-error"> 
			<div class="result-bg"></div>
			<div class="result-showfail">
			     <div>
			     	<img src="images/5.png" id="result-pic" />
			     </div>
			     <div>
			     	<p id="result-in">失败原因——申请提交失败！</p>
			     </div>
			</div>
		</div>

        <header>注：以下商品单价及总金额为含税17%。</header>
		<div id="fullbg"></div> 
		 <div id="dialog"> 
                  <p class="close"><a href="#" onclick="theCommonFn.closeBg();">关闭</a></p> 
                  <div>正在加载，请稍后....</div> 
         </div> 
		<div class="supplier cell">
			<div class="supplier-choose">
				<div>供应商</div>
				<div class="supplier-choose-in">
					<select id="cells">
						<option>请选择供应商</option>
					</select>
				</div>
			</div>
            <div2>
				<div2 class="supplier-address-in" id = "supplier-address-in">		
				</div2>
	        </div2>
			<!-- <div class="supplier-address">
				<div>供应商地址</div>
				<div class="supplier-address-in" id = "supplier-address-in">
				</div>
			</div> -->
			<div class="supplier-addr">
				<div>交货地址</div>
				  <div class="supplier-addr-in">
					 <div data-toggle="distpicker">
					   <select id ="provinceSelect" data-province="省"></select>
					   <select id ="citySelect" data-city="市"></select>
					   <select id ="districtSelect" data-district="区"></select>
					 </div>
				  </div>
			   </div>

            <div class="goodsWarehouse">
				 <div>交货仓库</div>
				   <div class="supplier-choose-in">
					   <select id="goodsWarehouseId">
						  <option>请选择交货仓库</option>
					   </select>
				   </div>
		    </div>
		    <div2>
				<div2 class="goodsWarehouse-address-in" id = "goodsWarehouse-address-in">		
				</div2>
	        </div2>
            <!-- <div class="goodsWarehouse-address">
				<div>交货仓库地址</div>
				  <div class="goodsWarehouse-address-in" id = "goodsWarehouse-address-in">		
				  </div>
			</div> -->

			 <!-- <div>
				<div class="goodsWarehouse-address-in" id = "goodsWarehouse-address-in">		
				</div>
	        </div> -->
	            <!--  <div class="goods-time">
						<div>入库时间</div>
						<div class="rightinput">
							<input type="text" id="picktime" class="picktime" value="" readonly>
						</div>
			     </div> -->

			     <div class="goods-time">
				    <div>入库时间</div>
					<div class="rightinput">
			            <div class="jewarp content jeitem" onclick="dateSelect(this)" >
		                   <div class="jeinpbox" style="width: 80%;"><input type="text" class="jeinput" id="testico" readonly></div>
		                  <div class="icons jebtns" ></div>
	                    </div>
					</div>
				</div>

		    </div>
            
		<div class="goods">
			<div class="goods-model" style="display: none;">
				<div class="goods-box cell">
					<div class="goods-info">
						<div>商品信息</div>
						<div class="goods-info-select">
							<div class="goods-info-select-type">
								<select id = "productType">
									<option>商品类型</option>
								</select>
							</div>
							<div class="goods-info-select-name">
								<select  id = "productNames">
									<option>商品名称</option>
								</select>
							</div>
						</div>
					</div>
					<div class="goods-num">
						<div>代购数量</div>
						<div class="goods-num-in goodsin">
							<div>
								<input type="text" onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}" onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"/>
								 <!--<input type="text" id="test" value="请输入">-->
							</div>
							<div>吨</div>
						</div>
					</div>
                  <div class="goods-weight">
						<div>公定总重量</div>
						<div class="goods-weight-in goodsin">
							<div>
								<input type="text"   id="weight" onKeyup="javascript:sendWeight(this);" onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}" onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"/>
								 <!--<input type="text" id="test" value="请输入">-->
							</div>
							<div>吨</div>
						</div>
					</div>
					<div class="goods-price">
						<div>意向单价</div>
						<div class="goods-price-in goodsin">
							<div>
								<input type="text"   id="price" onKeyup="javascript:sendPrice(this);" onkeyup="if(isNaN(value))execCommand('undo')" onafterpaste="if(isNaN(value))execCommand('undo')"/>
							</div>
							<div>元/每吨</div>
						</div>
					</div>
					<div class="goods-total">
						<div>商品总价</div>
						<div class="goods-total-in goodsin" id = "totalPrice">
							<div>
								<input type="text" onkeyup="if(isNaN(value))execCommand('undo')" onafterpaste="if(isNaN(value))execCommand('undo')"/>
							</div>
							<div>元</div>
						</div>
					</div>
					  <div class="goods-convention">
						<div>特殊约定</div>
						<div class="goods-convention-in goodsin">
							<div>
								<input type="text" onkeyup="if(isNaN(value))execCommand('undo')" onafterpaste="if(isNaN(value))execCommand('undo')"/>
							</div>
						</div>
					</div>
					<div class="goods-delete">删除此商品</div>
				</div>
			</div>
			<div class="good-wrap">
				<div class="goods-box cell">
					<div class="goods-info">
						<div>商品信息</div>
						<div class="goods-info-select">
							<div class="goods-info-select-type">
								<select id = "productTypeFirst">
									<option>商品类型</option>
								</select>
							</div>
							<div class="goods-info-select-name">
								<select id = 'productNamesFirst'>
									<option>商品名称</option>
								</select>
							</div>
						</div>
					</div>
					<div class="goods-num">
						<div>代购数量</div>
						<div class="goods-num-in goodsin">
							<div>
								<input type="text" onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}" onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"/>
								 <!--<input type="text" id="test" value="请输入">-->
							</div>
							<div>吨</div>
						</div>
					</div>
					 <div class="goods-weight">
						<div>公定总重量</div>
						<div class="goods-weight-in goodsin">
							<div>
								<input id="weight" type="text" onKeyup="javascript:sendWeight(this);" onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}" onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"/>
								 <!--<input type="text" id="test" value="请输入">-->
							</div>
							<div>吨</div>
						</div>
					</div>
					<div class="goods-price">
						<div>意向单价</div>
						<div class="goods-price-in goodsin">
							<div>
								<input  id="price" type="text" onKeyup="javascript:sendPrice(this);" onkeyup="if(isNaN(value))execCommand('undo')" onafterpaste="if(isNaN(value))execCommand('undo')"/>1
							</div>
							<div>元/每吨</div>
						</div>
					</div>

					<!--<div class="goods-total">
						<div>商品总价</div>
						<div class="goods-total-in goodsin">
							<div>
								<input id="totalPrice" type="text" onkeyup="if(isNaN(value))execCommand('undo')" onafterpaste="if(isNaN(value))execCommand('undo')"/>
							</div>
							<div>元</div>
						</div>
					</div>-->

					 <div class="goods-total">
				         <div>商品总价</div>
				         <div class="goods-total-in goodsin" id = "totalPrice">		
				         </div>
			         </div>

                    <div class="goods-convention">
						<div>特殊约定</div>
						<div class="goods-convention-in goodsin">
							<div>
								<input type="text" onkeyup="if(isNaN(value))execCommand('undo')" onafterpaste="if(isNaN(value))execCommand('undo')"/>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="goods-add">
				+添加更多商品
			</div>
		</div>

		<div class="deal">
			<span class="dealno"></span><span>已阅读</span><a href="contractZSZY.html">《代购服务协议》</a>
		</div>
	    <div class="submit" id="put">提交</div>
	    <!--<div class="submit" id="test1">这是一个测试</div>
	    <div class="submit" id="close">来点爸爸呀</div>-->
	    
		<script>
		// startRecordBtn.onclick = function(){
  //          alert("https://itunes.apple.com/cn/app/wei-ruan-shi-hua/id1153109870?mt=8")
  //          bridge.callHandler('pushBack', {}, function responseCallback(responseData) {
  //             log("JS received response:", responseData)
  //          })
  //        }
  //事件绑定
			var add = $('.goods-add'),
			    foodWrap = $('.good-wrap'),
			    box = $('.goods-box');
			    submitBtn = $('#put');
			    testBtn = $('#test1');
			    closeBtn = $('#close');
			    theDeal = $('.deal>span').eq(0);
			    suppilerAddress=[];
			    suppilerWarehouse=[];
			    mtn = theCommonFn.getMtnByUrl();
			    loginId = theCommonFn.getLoginIdByUrl(); 
			    fromType = theCommonFn.getFromTypeByUrl();
			    mobile = theCommonFn.getMobileByUrl();
                buildID = theCommonFn.getBuildIdByUrl();	
                loc = theCommonFn.getLocByUrl();
                versionID = theCommonFn.getVersionIDByUrl();
			    inputArea = $('input');
			 // var goodsWeight,
			 //    goodsPrice,
			 //    goodsTotal;

			    theDeal.click(function(){
				if($(this).hasClass('dealno')){
					$(this).removeClass('dealno').addClass('dealyes');
				}else{
					$(this).removeClass('dealyes').addClass('dealno');
				}
			});

			     testBtn.click(function(){
			    	bridge.callHandler('pushBack', {}, function responseCallback(responseData) {
              log("JS received response:", responseData)
           })
			    });

			    closeBtn.click(function(){
			    	window.AndroidWebView.finishWebView();
			    });

   //         //时间控件配置
			// var config = {
			// 	mode : 1, //时间选择器模式：1：年月日，2：年月日时分（24小时），3：年月日时分（12小时），4：年月日时分秒。默认：1
			// 	format : 2, //时间格式化方式：1：2015年06月10日 17时30分46秒，2：2015-05-10  17:30:46。默认：2
			// 	years : [2000, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021], //年份数组
			// 	nowbtn : true, //是否显示现在按钮
			// 	onOk : function(){
			// 		//alert('OK');
			// 	},  //点击确定时添加额外的执行函数 默认null
			// 	onCancel : function(){				
			// 	}, //点击取消时添加额外的执行函数 默认null
			// };

			//     //时间控件调用
			// $('#picktime').mdatetimer(config);

			 //日期控制
            function dateSelect(inputobj){
       	       var a = $(inputobj);
       	       $.jeDate(a.find("#testico"),{trigger:false,format: 'YYYY-MM-DD'})
            }
                 
            //获取供应商信息-初始
			$.ajax({
				type:"post",
				url:"https://wei.wiyarn.com/actiz/rs/b?_s=coop&_m=listSupplier",
				async:true,
				data:{
					loginId: loginId,
					mtn: mtn,
					fromType:fromType,
					mobile:mobile,
					buildID:buildID,
					loc:loc,
					versionID:versionID
				},
				beforeSend:function(){
					//theCommonFn.waiting();
				},
				success:function(rep){
                      var reps;
					try{
						reps = JSON.parse(rep);		
					}catch(e){
						//TODO handle the exception
					};
					if(reps.result){
						var str = '',
						    list = reps.content;
						for(var i=0;i<list.length;i++){
							str += '<option data-id="'+list[i].supplier_id +'" >'+list[i].company_name+'</option>',
							suppilerAddress.push({
								"dataId":list[i].supplier_id,
								"address":list[i].address
							})
						};
					// 	$('#cells').append(str);
					};
					console.log('这里是测试！！！：'+ suppilerAddress);
					$('#cells').append(str);
				},
				error:function(){
					theCommonFn.alertWin('服务器出错')
				}
			});
  
             //交货仓库信息获取-初始
             $.ajax({
				type:"post",
				url:"https://wei.wiyarn.com/actiz/rs/b?_s=coop&_m=listStroeByArea",
				async:true,
				data:{
					loginId: loginId,
					mtn: mtn,
					fromType:fromType,
					mobile:mobile,
					buildID:buildID,
					loc:loc,
					versionID:versionID
				},
				beforeSend:function(){
					//theCommonFn.waiting();
				},
				success:function(rep){
                      var reps;
					try{
						reps = JSON.parse(rep);		
					}catch(e){
						//TODO handle the exception
					};
					if(reps.result){
						var str = '',
						    list = reps.content;
						for(var i=0;i<list.length;i++){
							str += '<option data-id="'+list[i].store_house_id +'" >'+list[i].store_house_name+'</option>',
							suppilerWarehouse.push({
								"houseId":list[i].store_house_id,
								"houseName":list[i].store_house_name,
								"houseAddress":list[i].address
							})
						};
					// 	$('#cells').append(str);
					};
					$('#goodsWarehouseId').append(str);
				},
				error:function(){
					theCommonFn.alertWin('服务器出错')
				}
			});

             // input监听
              // $("input").focus(function(){
              //    $(this).css("background-color","#EDEDED");
              //    console.log("success");
              //  });
              // $("input").blur(function(){
              //   $(this).css("background-color","#FFFFFF");
              // });
              $('.goods').on('focus','input',function(){
	            $(this).css("background-color","#EDEDED");
               });
              $('.goods').on('blur','input',function(){
	            $(this).css("background-color","#FFFFFF");
               });

                function sendWeight(inputobj){
               	    var goodsWeight = inputobj.value;
                    var jqueryinputobj = $(inputobj);
                    var goodsPrice = jqueryinputobj.parent().parent().parent().parent().find("#price").val();
                    jqueryinputobj.closest("div[class~=cell]").find("#totalPrice").html(goodsWeight*goodsPrice);
                 }

                function sendPrice(inputobj){
               	    var goodsPrice = inputobj.value;
                    var jqueryinputobj = $(inputobj);
                    var goodsWeight = jqueryinputobj.parent().parent().parent().parent().find("#weight").val();
               	    jqueryinputobj.closest("div[class~=cell]").find("#totalPrice").html(goodsWeight*goodsPrice);
                 }
   
             //监听仓库选择
             $("#goodsWarehouseId").change(function() {
             	var wareHouseId = $(this).find("option:selected").attr("data-id");
             	   for(var i =0; i < suppilerWarehouse.length; i++){
             	   	  console.log(wareHouseId);
             	   	  if (wareHouseId.toString() == suppilerWarehouse[i].houseId){
             	   	  	//alert(suppilerWarehouse[i].houseAddress);
             	   	  	$("#goodsWarehouse-address-in").text(suppilerWarehouse[i].houseAddress);
             	   	  	$("#goodsWarehouse-address-in").show();
             	       }
             	   }
             });

            //监听供应商选择窗口，增添商品类型列表信息
            $("#cells").change(function() {
                var suppilerId = $(this).find("option:selected").attr("data-id");
                for(var i = 0 ;i<suppilerAddress.length;i++){ //插入地址信息
                    if (suppilerId.toString() == suppilerAddress[i].dataId){
                 	    $("#supplier-address-in").text(suppilerAddress[i].address);
             	   	  	$("#supplier-address-in").show();
                 	}
                }
	          $.ajax({
				type:"post",
				url:"https://wei.wiyarn.com/actiz/rs/b?_s=coop&_m=listProductType",
				async:true,
				data:{
					loginId: loginId,
					mtn: mtn,
					fromType:fromType,
					mobile:mobile,
					buildID:buildID,
					loc:loc,
					versionID:versionID,
					supplier_id:suppilerId
				},
				beforeSend:function(){
					//theCommonFn.waiting();
				},
				success:function(rep){
                      var reps;
					try{
						reps = JSON.parse(rep);	
					}catch(e){
						//TODO handle the exception
					};
					if(reps.result){
						var str = '<option>商品类型</option>',
						//var str_address,
						list = reps.content;
						//console.log(suppilerAddress[0].address);
						//$('supplier-address-in').replace(suppilerAddress[0].address);

						for(var i=0;i<list.length;i++){
							str += '<option data-id="'+list[i].product_type_id +'" >'+list[i].product_type_name+'</option>'
						};

					   $('#productTypeFirst option').remove();//首框删除老的选择内容
					   $('#productTypeFirst').append(str);  //首框插入新的内容
                       $('#productType option').remove();//后续框删除老的选择内容
					   $('#productType').append(str);  //后续框插入新的内容
					};
				},
				error:function(){
					theCommonFn.alertWin('服务器出错')
				}
			});
            });          

            ///添加list同时绑定select元素用以监听
			add.click(function(){
				var theModel = $('.goods-model').children().clone();
				theModel.appendTo(foodWrap);
				 $("select").change(function() {
                	var firstSelect=$(this);  //产品类型选择框
                	var productTypeId = $(this).find("option:selected").attr("data-id");
                	var secondSelect=firstSelect.parent().siblings().children(); //产品名字选择框
                	var secondSelectParent = $(this).parent().siblings().find("option");//产品名字框上级属性，用来清除使用
                	 var suppilerId = $('#cells').find("option:selected").attr("data-id");
                    getProductNameListNext(secondSelect,productTypeId,secondSelectParent,suppilerId);
                    console.log("当前窗口为："+ $(this).find("option:selected").attr("data-id"));
                   });
			});
			foodWrap.on('click','.goods-delete',function(){
				$(this).parent().remove();
			});

			 //首框展示
          $("#productTypeFirst").change(function() {
          	     var productTypeId = $(this).find("option:selected").attr("data-id");
          	     var suppilerId = $('#cells').find("option:selected").attr("data-id");
                 getProductNameList(productTypeId,suppilerId);
            });

        //首个产品列表信息
          function getProductNameList(productTypeId,suppilerId){
                 $.ajax({
				type:"post",
				url:"https://wei.wiyarn.com/actiz/rs/b?_s=coop&_m=listProductByTypeId",
				async:true,
				data:{
					loginId: loginId,
					mtn: mtn,
					fromType:fromType,
					mobile:mobile,
					buildID:buildID,
					loc:loc,
					versionID:versionID,
					supplier_id:suppilerId,
                    productTypeId: productTypeId
				},
				beforeSend:function(){
				},
				success:function(rep){
					var reps;
					try{
						reps = JSON.parse(rep);	
							console.log("start");
						console.log(reps);
						console.log("end");
					}catch(e){
						//TODO handle the exception
					};
					if(reps.result){
						var str = '<option>商品类型</option>',
						    list = reps.content;
						for(var i=0;i<list.length;i++){
							str += '<option data-id="'+list[i].product_id +'" >'+list[i].product_name+'</option>'
						};                   
						 $('#productNamesFirst option').remove();//首框删除老的选择内容
					     $('#productNamesFirst').append(str);  //首框插入新的内容
					       // secondSelect.remove();
					       // secondSelect.append(str);
					}
				},
				error:function(){
					theCommonFn.alertWin('服务器出错')
				}
			});
           }

           function getProductNameListNext(secondSelect,productTypeId,secondSelectParent,suppilerId){
 	             var secondSelectObject = secondSelect;
 	             var productTypeIdResult = productTypeId;
 	             secondSelectParentObject = secondSelectParent;
                 $.ajax({
				type:"post",
				url:"https://wei.wiyarn.com/actiz/rs/b?_s=coop&_m=listProductByTypeId",
				async:true,
				data:{
                    loginId: loginId,
					mtn: mtn,
					fromType:fromType,
					mobile:mobile,
					buildID:buildID,
					loc:loc,
					versionID:versionID,
					supplier_id:suppilerId,
                    productTypeId:productTypeIdResult
				},
				beforeSend:function(){
				},
				success:function(rep){
					var reps;
					try{
						reps = JSON.parse(rep);	
					}catch(e){
						//TODO handle the exception
					};
					if(reps.result){
						var str = '<option>商品类型</option>',
						    list = reps.content;
						for(var i=0;i<list.length;i++){
							str += '<option data-id="'+list[i].product_id +'" >'+list[i].product_name+'</option>'
						};
                         // $('#productNames').remove();//删除老的选择内容
					     //$('#productNames').append(str);  //首框插入新的内容
					     secondSelectParentObject.remove();
					     secondSelect.append(str);
					}
				},
				error:function(){
					theCommonFn.alertWin('服务器出错')
				}
			});
           }

           submitBtn.click(function(){
 //  没填的提醒别人填写
    		var isError = 0 ;
    		
    		var select_title;
    		$('.good-wrap').find('select').each(function(i,item){
						select_title = $(this).eq(0).val();
						var selectValue = $(this).find("option:selected").attr("data-id");
						if(selectValue==null){
								isError = 1;
								return false;
						}
				})
    		if(isError == 1){
	        	theCommonFn.alertWin("请选择 '"+select_title+"'");
	        	return;
        }
        
    		var storeHouseId = $('#cells').find("option:selected").attr("data-id");
				if(storeHouseId==null){
						theCommonFn.alertWin('请选择交货仓库');
						return;
				}
				
    		var node_title;
    		$('.good-wrap').find('input').each(function(i,item){
						if(!$(this).val()){
								node_title = $(this).parent().prev().text();
								isError = 1;
								return false;
						}
				})
				
				if(isError == 1){
	        	//theCommonFn.alertWin("请填写 '"+node_title+"'");
	        	theCommonFn.alertWin("请填写完整");
	        	return;
                }
				
				if(theDeal.hasClass('dealno')){
						theCommonFn.alertWin("您未同意 '代购服务协议'");
						isError = 1;
						return;
				}
				
        if(isError == '1'){
        	return;
        }
	        var kk = 0;
           	var product =[];
            var suppilerId = $('#cells').find("option:selected").attr("data-id");
            var suppliername = $('#cells').find("option:selected").val();
            var supplieradress = $('#supplier-address-in').html();
            var province = $('#provinceSelect').find("option:selected").val();
            var city = $('#citySelect').find("option:selected").val();
            var area = $('#districtSelect').find("option:selected").val();
            var storeHouse_Id = $('#goodsWarehouseId').find("option:selected").attr("data-id");
            var jh_time = $('#picktime').val();
 
           	for(var i=0;i<$('.good-wrap').find('.goods-box').length;i++){
					// var info3 =  $("#test").val();//可以的
					var info = $('.good-wrap').find('.goods-box').eq(i);
					//console.log(info.find('#totalPrice')[0]);//correct
					//console.log(info.find('#totalPrice')[0].val());//correct
                    console.log("hi:"+info.find('#totalPrice').html());  //$(info.find('#totalPrice')[0]).val()
					product.push({
							"productClassifyId":info.find("option:selected").attr("data-id"),
							"productTypeName":$.trim(info.find('.goods-info-select-type select').val()),
							"productid":info.find('#productNamesFirst').find("option:selected").attr("data-id"),
							"productname":$.trim(info.find('.goods-info-select-name select').val()),
							"goods_num":$.trim(info.find('.goods-num input').val()),
							"goods-weight":$.trim(info.find('.goods-weight input').val()), 
							"goods-price":$.trim(info.find('.goods-price input').val()), 
							//"goods-total":$.trim(info.find('.goods-total-in').val()), //totalPrice
							"goods-total":info.find('#totalPrice').html(),
                            "goods-convention":$.trim(info.find('.goods-convention input').val())
					})
                     kk += 1; 
					console.log(product);
				};

				//console.log("一共有" + kk +"个商品");
				product = JSON.stringify(product);
            	$.ajax({
						type:"post",
				        url:"https://wei.wiyarn.com/actiz/rs/b?_s=coop&_m=createPurchasing",
				        async:true,
				            data:{
                              _vt:'dlk_weishatest',
					          loginId: loginId,
					          suppilerid:suppilerId,
                              suppliername:suppliername,
                              supplieradress:supplieradress,
					          national:1,
					          province:province,
					          city:city,
					          area:area,
					          currency:2,
					          unitId:1,
					          storeHouse_Id:storeHouse_Id,
					          mtn: mtn,
					          fromType:fromType,
					          mobile:mobile,
					          buildID:buildID,
					          versionID:versionID,
					          jh_time:jh_time,
					          sign:'b92d3f53c061fafcfe8a1041b2cf4baf',
					          loc:loc,
					          djunit:'元/吨',
				            },
				            success:function(rep){
                                var reps;
					            try{
					                reps = JSON.parse(rep);		
				                 }catch(e){				
					             };
						        if(reps.result){
						            $("#result-success").show();
					                theCommonFn.delay2('3000');
						            theCommonFn.waitAndClosePrompts('1','7000');
						            theCommonFn.delay2('5000');
					            }else{
						            $("#result-error").show();
						            setTimeout("$('#result-error').hide();",3000);
					            } 
				        }
				})
           });
		</script>
	</body>
</html>
